---
import Image from "astro/components/Image.astro";

interface Props {
  name: string;
  text: string[];
  badge: string;
  image: string;
  soul: boolean | undefined;
}
const { name, text, badge, image, soul } = Astro.props;

const base_path = "../../../assets/2x";
const images = import.meta.glob<{ default: ImageMetadata }>(
  "../../../assets/2x/*.png"
);
const image_path = `${base_path}/${image}.png`;

const regex = /{([^}]+)}/g;
const modifiedText = text.map((line) => {
  return (
    line.replace("{}", "</span>").replace(regex, (_match, p1) => {
      const classes: string[] = [];
      p1.split(",").forEach((item: string) => {
        const [selector, color] = item.split(":");
        if (selector === "C") {
					switch(color){
						case "white":
							classes.push("text-white")
						case "mult":
							classes.push("text-balatro-red");
							break;
						case "chips":
							classes.push("text-balatro-blue");
							break;
						case "attention":
							classes.push("text-balatro-orange");
							break;
						case "money":
							classes.push("text-balatro-gold");
							break;
						case "dark_edition":
							classes.push("text-balatro-blue-special");
							break;
						case "inactive":
							classes.push("text-balatro-grey-light");
							break;
					}
        } else if (selector === "X") {
					switch(color){
						case "mult":
							classes.push("bg-balatro-red");
							break;
					}
          classes.push("rounded-md px-1");
        }
      });
      return "</span><span class='" + classes.join(" ") + "'>";
    }) + "</span>"
  );
});

let badgeColor = "bg-balatro-inactive";
let badgeShadowColor = "shadow-black";
switch (badge.toLowerCase()) {
  case "common":
    badgeColor = "bg-balatro-blue";
    badgeShadowColor = "shadow-balatro-blue-dark";
    break;
  case "uncommon":
    badgeColor = "bg-balatro-green";
    badgeShadowColor = "shadow-balatro-green-dark";
    break;
  case "rare":
    badgeColor = "bg-balatro-red";
    badgeShadowColor = "shadow-balatro-red-dark";
    break;
  case "legendary":
    badgeColor = "bg-balatro-purple";
    badgeShadowColor = "shadow-balatro-purple-dark";
    break;
}
---

<div
  class="bg-balatro-black border-4 border-balatro-outline px-8 w-80 flex flex-col items-center gap-2 py-4 rounded-2xl shadow-balatro shadow-balatro-grey-dark text-2xl"
>
  <!-- Name -->
  <h3 class="text-4xl text-shadow-lg capitalize">{name}</h3>
	<!-- Image -->
  <div class="relative w-36 h-48">
    <Image
      src={images[image_path]()}
      alt=" "
      class="col-span-1 object-cover drop-shadow-soul absolute top-0 left-0 object-left w-36 h-48 render-pixelated"
    />
    {
      soul && (
			<!-- Soul  -->
        <Image
          src={images[image_path]()}
          alt=" "
          class="absolute top-0 left-0 object-cover object-right w-36 h-48 render-pixelated drop-shadow-soul animate-soul"
        />
      )
    }
  </div>
	<!-- Badge -->
  <div
    class={`rounded-full w-36 shadow-balatro text-center capitalize ${badgeColor} ${badgeShadowColor} text-shadow`}
  >
    {badge}
  </div>
	<!-- Description -->
  <p
    class="px-2 bg-white rounded-2xl shadow-balatro w-full shadow-balatro-grey-dark min-h-20 content-center text-center text-balatro-black"
  >
    {
      modifiedText.map((line) => (
        <>
          <Fragment set:html={line} />
          <br />
        </>
      ))
    }
  </p>
</div>
